<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <meta name="format-detection" content="telephone=no" />
    <title>图片裁剪</title>
    <meta name="description" content="" />
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://unpkg.com/jcrop/dist/jcrop.css">

  </head>
  <body>
    <div class="container">
        <button id="submit">确定</button>
        <div class="img--container">
            <img id="target" src="img/001.jpg">
        </div>
        <canvas id="canvas" class="canvas" width="600" height="600"></canvas>

        <img src="" alt="" id="picture">
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js"></script>
    <script src="https://unpkg.com/jcrop"></script>
    <script src="js/canvas.js"></script>
    <script>
        // element
        const submit = document.getElementById('submit')
        const picture = document.getElementById('picture')
        const target = document.getElementById('target')

        // canvas
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

       /*  ctx.fillStyle = "green";

        ctx.fillRect(10, 10, 150, 100);

        let image = new Image();

        image.onload = function () {
            ctx.drawImage(image, 33, 71, 104, 124, 21, 20, 87, 104);
        };

        image.src = "img/001.jpg"; */


        // jcrop
        const jcrop = Jcrop.attach('target');

        const rect = Jcrop.Rect.create(0,0,100,100);
        const options = {};
        const widget = jcrop.newWidget(rect,options);

        console.log(jcrop.active.pos);

        jcrop.listen('crop.change',function(widget,e){
            const pos = widget.pos;
            console.log(pos.x,pos.y,pos.w,pos.h);
        });

        // 确认裁剪
        submit.addEventListener('click', function() {
            console.log('jcrop.active.pos', jcrop.active.pos)
            
            const pos = jcrop.active.pos
            const {x,y,w,h} = pos

            

            let image = new Image();
            image.onload = function () {
                ctx.drawImage(image, x,y,w,h,x,y,w,h);
            };
            image.src = "img/001.jpg";
            // ctx.drawImage(target, x,y,w,h,x,y,w,h);

            canvas.width = w
            canvas.height = h

            const img = canvas.toDataURL("image/png");
            picture.src = img
        }, false)


    </script>
  </body>
</html>
